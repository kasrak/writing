<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My summer at Khan Academy</title>
    <link href='http://fonts.googleapis.com/css?family=PT+Serif:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="style.css">
    <script src="code.js" async></script>
</head>
<body>
    <div class="content">
        <div class="header">
            <h1><a href="http://www.kasrak.com">Kasra Kyanzadeh</a></h1>
        </div>

        <h1 class="title">My internship at Khan Academy</h1>

        <section class="clearfix">
            <div class="media-container right inset" style="width: 180px">
                <a href="https://www.khanacademy.org/profile/kasrak">
                    <img src="img/badge.png" class="right" width="100">
                </a>
                <div class="media-caption">
                    I wrote all this code and all I got was this badge.
                    Just kidding, interns are paid.
                </div>
            </div>

            <p>
            I spent the past summer working on the mobile team at Khan Academy.
            This post is a recap of some of the things I worked on during my
            internship.
            </p>

            <p>
            Some background first: Khan Academy is a non-profit with a mission
            of providing a free world-class education for anyone anywhere. It's
            best known for the videos, but there are hundreds of interactive
            math exercises that students can use to practice and master skills
            ranging from counting to calculus. Here's what an exercise looks
            like on the website:
            </p>

            <div class="media-container center">
                <img src="img/khan-website.png">
            </div>

            <p>
            For the past few months, the mobile team has been working to bring
            these exercises to the iPad app.
            </p>
        </section>

        <section class="clearfix">
            <h2>Related videos</h2>

            <p>
            Most exercises have related videos that the student can watch if they're stuck. My first project was to implement a native version of the related videos interface. We liked how the YouTube app let you drag down a video to interact with other content, so that's what I started with.
            </p>

            <div class="media-container">
                <div class="media-caption big  right" style="width: 280px">
                    <p>
                    In the first prototype, the video stayed on a fixed track, using the finger's y-coordinate to interpolate the position on the track. This felt awkward on the iPad: if you didn't drag along the path, your finger's movement would become disconnected from the movement of the video.
                    </p>

                    <p>
                    We also realized that always having a thumbnail on the screen would be a waste of precious pixels, especially since a lot of the thumbnails would be black rectangles with a few scribbles.
                    </p>
                </div>
                <div class="video-player" style="width: 434px; height: 562px;">
                    <div class="fake-ipad">
                        <video poster="img/related-videos-0.png"
                               loop>
                               <source src="img/related-videos-0.mp4"
                                       type="video/mp4">
                               <source src="img/related-videos-0.webm"
                                       type="video/webm">
                        </video>
                    </div>
                    <div class="play-button"></div>
                    <div class="pause-button"></div>
                </div>
            </div>

            <p>
            So we decided the video should have three states: hidden, maximized, and docked. The docked video would play the video in the corner, letting the student interact with the exercise while watching the video.
            </p>

            <div class="media-container">
                <div class="media-caption big right" style="width: 280px">
                    <p>
                    Since exercises can have multiple related videos, this version also let the student swipe left and right to switch between the different videos when the videos are maximized.
                    </p>
                    <p>
                    This prototype let the video to be docked anywhere along the bottom of the screen. As we added more UI elements to the screen, we ended up pinning the docked video to the bottom right to make it more consistent.
                    </p>
                </div>
                <div class="video-player" style="width: 436px; height: 566px">
                    <div class="fake-ipad">
                        <video poster="img/related-videos-free-docking.png"
                               loop>
                               <source src="img/related-videos-free-docking.webm"
                                       type="video/webm">
                               <source src="img/related-videos-free-docking.mp4"
                                       type="video/mp4">
                        </video>
                    </div>
                    <div class="play-button"></div>
                    <div class="pause-button"></div>
                </div>
            </div>

            <p>I spent a lot of time playing with these prototypes. I noticed that when docking the video, if your finger was not centered in the video view, your finger would become detached from the video as it shrunk. I fixed it by setting the view's anchor point to the touch position, which makes the view shrink around the user's fingerâ€”a simple fix that prevents limb-view detachment. See for yourself:</p>

            <div class="video-player">
                <div class="media-container left half">
                    <video loop>
                           <source src="img/related-videos-set-anchor-no.webm"
                                   type="video/webm">
                           <source src="img/related-videos-set-anchor-no.mp4"
                                   type="video/mp4">
                    </video>
                    <div class="media-caption">
                        Anchor point is always in the center.
                        The touch leaves the view as it shrinks.
                    </div>
                </div>
                <div class="media-container right half">
                    <video loop>
                           <source src="img/related-videos-set-anchor-yes.webm"
                                   type="video/webm">
                           <source src="img/related-videos-set-anchor-yes.mp4"
                                   type="video/mp4">
                    </video>
                    <div class="media-caption">
                        Anchor point is set to the touch position.
                        The view resizes around the touch, so the
                        touch never leaves the view.
                    </div>
                </div>

                <div class="play-button" style="background-position-y: 200px"></div>
                <div class="pause-button" style="background-position-y: 200px"></div>
            </div>

            <p>I tried implementing all of this with <a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIDynamicAnimator_Class/index.html#//apple_ref/occ/cl/UIDynamicAnimator">UIDynamics</a>, but ended up switching to <a href="https://github.com/facebook/pop">POP</a> because UIDynamics doesn't provide an easy way to tell when animations have quiesced (I needed to know when to pause and play the video). As a bonus, POP made it pretty easy to have the animations be interruptible.</p>

            <p>Plot twist! Most of this didn't make it into the app. When we tested with real students, it wasn't clear that the fancy interactions were helpful. Most people didn't discover the docking, and some of the people that <em>did</em> figure it out were confused: a lot of them tried pinching the video to dismiss it. It was clear that we had a lot more polishing to do, but we weren't sure docking would actually benefit students. So we ended up shipping a simpler implementation.</p>

        </section>

        <section>
            <h2>Scratchpad</h2>

            <p>My next project was to make a native version of the exercise scratchpad. This ended up being my biggest project.</p>

            <p>The scratchpad canvas is a native view that sits on top of the web view rendering the exercise content. To complicate matters, most exercises have interactive components. Here's a video of the final scratchpad in action:</p>

            <div class="media-container center">
                <div class="fake-ipad">
                    <div class="video-player">
                        <video loop>
                           <source src="img/scratchpad-full.webm"
                                   type="video/webm">
                           <source src="img/scratchpad-full.mp4"
                                   type="video/mp4">
                        </video>
                        <div class="play-button"></div>
                        <div class="pause-button"></div>
                    </div>
                </div>
            </div>

            <p>
                <img src="img/scratchpad-view-sandwich.png" width="300">
            </p>

            <p>
            Hit testing in the webview attempts. e.preventDefault(). Issues with
            that. Final solution: async hit test, forward compatible when we
            switch to WKWebView.
            </p>

            <p>
            Two finger scrolling: human fingers are not very precise. Have to
            cancel drawing if second finger shows up within a threshold.
            Shoutout to Matt Drance for helping with this.
            </p>

            <p>
            Shoutout to Andy for improving inking.
            </p>
        </section>

        <section>
            <h2>Healthy Hackathon</h2>

            <p>
            Healthy hackathon project. How can we make the iteration of
            interactive designs easier (see related videos).
            </p>

            <p>
            Got to play with React. Immutable app architecture.
            </p>
        </section>

        <section>
            <h2>Other things&hellip;</h2>

            <div class="media-container center">
                <video style="width: 444px; height: 82px"
                       autoplay loop>
                       <source src="img/exercise-progression.webm"
                               type="video/webm">
                       <source src="img/exercise-progression.mp4"
                               type="video/mp4">
                </video>
                <div class="media-caption" style="width: 400px">
                    A bouncy animation I made to show the user's progress
                    in an exercise.
                    Thanks to fellow intern
                    <a href="http://www.elizabethylin.com/">Elizabeth Lin</a>
                    for helping design this
                    and many of the other things you saw in this post!
                </div>
            </div>

            <h3>UIWebView &rarr; WKWebView</h3>

            <h3>Launch to exercise</h3>

            <p>
            I added a way to go directly to a specific exercise when running
            the app from Xcode. A simple change, but one that saved a lot of
            time. Before, we would launch the app and either browse to an
            exercise (at least 5 taps) or search for an exercise (2 taps +
            5 keystrokes).
            </p>

            <p>
            It uses a custom scheme that sets an environment variable
            indicating the exercise to load on launch.
            </p>

            <div class="media-container center scheme-screenshot-container" style="position: relative">
                <img src="img/question-mark.png"
                     style="position: absolute; bottom: 120px; right: 30px;"
                     class="clickable overlay-toggle"
                     onclick="toggleOverlayWithId('customSchemeOverlay')">
                <img src="img/custom-scheme.png"
                     style="width: 893px; height: 600px">
            </div>

            <div id="customSchemeOverlay" class="overlay" style="margin-top: -90px">
                <img src="img/overlay-arrow.png" class="overlay-arrow" style="right: 36px">
                <p>
                Read the environment value in <code>application:didFinishLaunchingWithOptions:</code>
                and take action accordingly!
                </p>
                <pre>
#if DEBUG
NSDictionary *env = [[NSProcessInfo processInfo] environment];
NSString *initialExerciseName = env[@"initialExerciseName"];
if (initialExerciseName) {
    [self loadExerciseWithName:initialExerciseName];
}
#endif
</pre>
            </div>


        </section>

        <section>
            <h2>Thank you!</h2>

            <div class="media-container center hipchat-screenshot-container">
                <img src="img/knowledge.png"
                     class="shadow-frame horizontally-center-on-page"
                     style="width: 819px; 128px">
                <div class="media-caption">
                    Dropping knowledge all over the place.
                </div>
            </div>

            <p>
            I had a blast! Thanks to everyone at Khan Academy, especially the iOS team for teaching me so much:
            <a href="https://twitter.com/omgitsmgp">Mike Parker</a>,
            <a href="https://twitter.com/andy_matuschak">Andy Matuschak</a>,
            <a href="https://twitter.com/savinola">Laura Savino</a>,
            and
            <a href="https://twitter.com/nsfmc">Marcos Ojeda</a>.
            </p>

            <p>
            And thank you for reading this! &lt;3
            </p>
        </section>

        <section>

            <p>P.S. If you want other interns' experiences, here are a bunch of posts:</p>

            <ul>
                <li>
                <a href="http://jamie-wong.com/2012/08/22/what-i-did-at-khan-academy/">Jamie Wong: What I did at Khan Academy</a> (2012)
                </li>
                <li>
                <a href="http://www.dylanv.org/2012/09/14/the-khan-academy-internship-experience/">Dylan Vassallo: The Khan Academy Internship Experience</a> (2012)
                </li>
                <li>
                <a href="http://benalpert.com/2012/08/24/what-i-did-at-khan-academy-2012.html">Ben Alpert: What I did at Khan Academy</a> (2012)
                </li>
                <li>
                <a href="http://david-hu.com/2011/11/02/how-khan-academy-is-using-machine-learning-to-assess-student-mastery.html">David Hu: How Khan Academy is using machine learning to assess student mastery</a> (2011)
                </li>
            </ul>
        </section>
    </div>
</body>
</html>
